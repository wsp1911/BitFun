@use '../../styles/tokens.scss' as tokens;

.code-editor {
  position: relative;
  width: 100%;
  height: 100%;

  &__wrapper {
    position: relative;
    width: 100%;
    height: 100%;
    border-radius: 12px;
    overflow: hidden;
    background: var(--color-bg-primary);
    border: 1px solid rgba(130, 170, 255, 0.25);
    box-shadow:
      0 8px 32px rgba(0, 0, 0, 0.5),
      0 0 0 1px rgba(127, 219, 202, 0.08) inset,
      0 2px 16px rgba(130, 170, 255, 0.12);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);

    &:hover {
      border-color: rgba(130, 170, 255, 0.4);
      box-shadow:
        0 12px 48px rgba(0, 0, 0, 0.6),
        0 0 0 1px rgba(127, 219, 202, 0.12) inset,
        0 2px 20px rgba(130, 170, 255, 0.2);
    }

    &::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 2px;
      background: linear-gradient(90deg,
        transparent 0%,
        rgba(199, 146, 234, 0.3) 25%,
        rgba(130, 170, 255, 0.5) 50%,
        rgba(127, 219, 202, 0.3) 75%,
        transparent 100%
      );
      z-index: 1;
    }

    :global {
      .monaco-editor {
        .margin,
        .monaco-editor-background,
        .inputarea.ime-input {
          background: transparent !important;
        }

        .margin-view-overlays .line-numbers {
          color: rgba(255, 255, 255, 0.35);
          font-weight: 400;
          font-variant-numeric: tabular-nums;
          transition: color 0.2s ease;
        }

        .margin-view-overlays .current-line ~ .line-numbers {
          color: rgba(130, 170, 255, 1);
          font-weight: 700;
          text-shadow: 0 0 10px rgba(130, 170, 255, 0.6);
          transform: scale(1.05);
        }

        .margin-view-overlays .line-numbers:hover {
          color: rgba(255, 255, 255, 0.6);
        }

        .view-overlays .current-line {
          background: linear-gradient(90deg,
            rgba(130, 170, 255, 0.08) 0%,
            rgba(127, 219, 202, 0.06) 50%,
            rgba(199, 146, 234, 0.04) 100%
          );
          border-left: 3px solid rgba(130, 170, 255, 0.5);
          border-right: none;
          animation: pulse-highlight 2s ease-in-out infinite;
        }

        @keyframes pulse-highlight {
          0%, 100% {
            opacity: 1;
          }
          50% {
            opacity: 0.85;
          }
        }

        .selected-text {
          background: rgba(59, 130, 246, 0.35) !important;
        }

        .monaco-scrollable-element > .scrollbar {
          .slider {
            background: linear-gradient(135deg,
              rgba(225, 171, 128, 0.35),
              rgba(199, 146, 234, 0.35)
            ) !important;
            border-radius: 6px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);

            &:hover {
              background: linear-gradient(135deg,
                rgba(225, 171, 128, 0.55),
                rgba(199, 146, 234, 0.55)
              ) !important;
              box-shadow: 0 0 8px rgba(225, 171, 128, 0.4);
            }

            &.active {
              background: linear-gradient(135deg,
                rgba(225, 171, 128, 0.7),
                rgba(199, 146, 234, 0.7)
              ) !important;
              box-shadow: 0 0 12px rgba(225, 171, 128, 0.5);
            }
          }
        }

        .cursor {
          background: linear-gradient(180deg,
            rgba(130, 170, 255, 1),
            rgba(127, 219, 202, 1)
          );
          width: 2px !important;
          box-shadow:
            0 0 16px rgba(130, 170, 255, 0.9),
            0 0 32px rgba(127, 219, 202, 0.5);
          animation: cursor-glow 1.5s ease-in-out infinite;
        }

        @keyframes cursor-glow {
          0%, 100% {
            box-shadow:
              0 0 16px rgba(130, 170, 255, 0.9),
              0 0 32px rgba(127, 219, 202, 0.5);
          }
          50% {
            box-shadow:
              0 0 20px rgba(130, 170, 255, 1),
              0 0 40px rgba(127, 219, 202, 0.7);
          }
        }

        .bracket-match {
          background: rgba(127, 219, 202, 0.15);
          border: 1px solid rgba(127, 219, 202, 0.7);
          border-radius: 2px;
          box-shadow: 0 0 10px rgba(127, 219, 202, 0.4);
          animation: bracket-pulse 0.3s ease-out;
        }

        @keyframes bracket-pulse {
          0% {
            transform: scale(1);
          }
          50% {
            transform: scale(1.05);
          }
          100% {
            transform: scale(1);
          }
        }

        .findMatch {
          background: rgba(255, 193, 7, 0.35);
          border: 1px solid rgba(255, 193, 7, 0.7);
          border-radius: 2px;
          box-shadow: 0 0 6px rgba(255, 193, 7, 0.3);
          animation: find-pulse 0.5s ease-out;
        }

        .currentFindMatch {
          background: rgba(255, 152, 0, 0.5);
          border: 1px solid rgba(255, 152, 0, 1);
          border-radius: 2px;
          box-shadow: 0 0 10px rgba(255, 152, 0, 0.5);
          animation: current-find-pulse 1s ease-in-out infinite;
        }

        @keyframes find-pulse {
          0% {
            transform: scale(1);
            opacity: 0.7;
          }
          50% {
            transform: scale(1.03);
            opacity: 1;
          }
          100% {
            transform: scale(1);
            opacity: 1;
          }
        }

        @keyframes current-find-pulse {
          0%, 100% {
            box-shadow: 0 0 10px rgba(255, 152, 0, 0.5);
          }
          50% {
            box-shadow: 0 0 16px rgba(255, 152, 0, 0.8);
          }
        }

        .cldr {
          &.codicon {
            color: rgba(255, 255, 255, 0.4);
            transition: all 0.2s ease;

            &:hover {
              color: rgba(130, 170, 255, 1);
              text-shadow: 0 0 10px rgba(130, 170, 255, 0.8);
              transform: scale(1.1);
            }
          }
        }

        .suggest-widget {
          background: linear-gradient(135deg,
            color-mix(in srgb, var(--color-bg-primary) 98%, transparent) 0%,
            color-mix(in srgb, var(--color-bg-secondary) 98%, transparent) 100%
          );
          border: 1px solid rgba(130, 170, 255, 0.4);
          border-radius: 10px;
          box-shadow:
            0 12px 48px rgba(0, 0, 0, 0.7),
            0 0 0 1px rgba(127, 219, 202, 0.08) inset,
            0 4px 16px rgba(130, 170, 255, 0.25);
          backdrop-filter: blur(20px);
          -webkit-backdrop-filter: blur(20px);
          overflow: hidden;

          &::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg,
              transparent 0%,
              rgba(199, 146, 234, 0.4) 25%,
              rgba(130, 170, 255, 0.7) 50%,
              rgba(127, 219, 202, 0.4) 75%,
              transparent 100%
            );
          }

          .monaco-list-row {
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 4px;
            margin: 2px 4px;

            &.focused {
              background: linear-gradient(90deg,
                rgba(130, 170, 255, 0.2) 0%,
                rgba(127, 219, 202, 0.15) 100%
              );
              box-shadow: 0 0 12px rgba(130, 170, 255, 0.3);
              transform: translateX(4px);
            }

            &:hover {
              background: rgba(130, 170, 255, 0.12);
            }
          }
        }

        .monaco-hover {
          background: linear-gradient(135deg,
            color-mix(in srgb, var(--color-bg-primary) 98%, transparent) 0%,
            color-mix(in srgb, var(--color-bg-secondary) 98%, transparent) 100%
          );
          border: 1px solid rgba(130, 170, 255, 0.4);
          border-radius: 8px;
          box-shadow:
            0 8px 40px rgba(0, 0, 0, 0.7),
            0 0 0 1px rgba(127, 219, 202, 0.08) inset,
            0 2px 12px rgba(130, 170, 255, 0.25);
          backdrop-filter: blur(20px);
          -webkit-backdrop-filter: blur(20px);
          animation: hover-fade-in 0.2s ease-out;
        }

        @keyframes hover-fade-in {
          0% {
            opacity: 0;
            transform: translateY(-4px);
          }
          100% {
            opacity: 1;
            transform: translateY(0);
          }
        }

        .parameter-hints-widget {
          background: linear-gradient(135deg,
            color-mix(in srgb, var(--color-bg-primary) 98%, transparent) 0%,
            color-mix(in srgb, var(--color-bg-secondary) 98%, transparent) 100%
          );
          border: 1px solid rgba(130, 170, 255, 0.4);
          border-radius: 8px;
          box-shadow:
            0 8px 40px rgba(0, 0, 0, 0.7),
            0 0 0 1px rgba(127, 219, 202, 0.08) inset,
            0 2px 12px rgba(130, 170, 255, 0.25);
          backdrop-filter: blur(20px);
          -webkit-backdrop-filter: blur(20px);

          .signature {
            transition: all 0.2s ease;

            &.focused {
              background: rgba(130, 170, 255, 0.1);
            }
          }
        }

        .minimap {
          opacity: 0.8;
          transition: opacity 0.3s ease;

          &:hover {
            opacity: 1;
          }

          .minimap-slider {
            background: linear-gradient(135deg,
              rgba(130, 170, 255, 0.2),
              rgba(127, 219, 202, 0.15)
            ) !important;
            border: 1px solid rgba(130, 170, 255, 0.3);

            &:hover {
              background: linear-gradient(135deg,
                rgba(130, 170, 255, 0.3),
                rgba(127, 219, 202, 0.25)
              ) !important;
            }
          }
        }

        .indent-guides {
          .indent-guide {
            border-left: 1px solid rgba(255, 255, 255, 0.06);

            &.indent-guide-active {
              border-left: 1px solid rgba(130, 170, 255, 0.6);
              box-shadow: -1px 0 6px rgba(130, 170, 255, 0.4);
            }
          }
        }
      }
    }
  }

  &--compact {
    .code-editor__wrapper {
      :global {
        .monaco-editor {
          .margin,
          .monaco-editor-background {
            background: color-mix(in srgb, var(--color-bg-primary) 20%, transparent) !important;
          }
        }
      }
    }
  }

  &--borderless {
    .code-editor__wrapper {
      border: none;
      box-shadow: none;
    }
  }

  &__fullscreen-btn {
    position: absolute;
    top: 12px;
    right: 12px;
    z-index: 10;
    padding: 8px;
    background: color-mix(in srgb, var(--color-bg-primary) 85%, transparent);
    border: 1px solid rgba(130, 170, 255, 0.4);
    border-radius: 6px;
    color: rgba(130, 170, 255, 0.8);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);

    &:hover {
      background: color-mix(in srgb, var(--color-bg-primary) 95%, transparent);
      border-color: rgba(130, 170, 255, 0.8);
      color: rgba(130, 170, 255, 1);
      box-shadow:
        0 4px 16px rgba(0, 0, 0, 0.6),
        0 0 20px rgba(130, 170, 255, 0.4),
        0 0 40px rgba(127, 219, 202, 0.2);
      transform: scale(1.08);
    }

    &:active {
      transform: scale(0.95);
    }

    svg {
      display: block;
      stroke-linecap: round;
      stroke-linejoin: round;
    }
  }

  &--fullscreen {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    width: 100vw !important;
    height: 100vh !important;
    z-index: tokens.$z-fullscreen;
    background: var(--color-bg-primary);
    animation: fullscreen-fade-in 0.3s ease-out;

    .code-editor__wrapper {
      width: 100%;
      height: 100%;
      border-radius: 0;
      border: none;
    }

    .code-editor__fullscreen-btn {
      top: 16px;
      right: 16px;
      background: color-mix(in srgb, var(--color-bg-primary) 90%, transparent);
      border-color: rgba(59, 130, 246, 0.5);

      &:hover {
        background: var(--color-bg-primary);
      }
    }
  }

  @keyframes fullscreen-fade-in {
    0% {
      opacity: 0;
    }
    100% {
      opacity: 1;
    }
  }

  @media (max-width: 768px) {
    .code-editor__wrapper {
      :global {
        .monaco-editor {
          font-size: 12px;
        }
      }
    }

    &__fullscreen-btn {
      top: 8px;
      right: 8px;
      padding: 6px;

      svg {
        width: 16px;
        height: 16px;
      }
    }
  }
}
