/**
 * Mermaid diagram rendering styles.
 * Colors come from CSS variables in theme/_tokens.scss.
 * Design: dashed-to-solid hover and variable-driven colors.
 */

// Diagram container.
.mermaid-diagram-container {
  svg {
    font-family: 'Inter', 'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif;
    
    &[style*="max-width"] {
      max-width: 100% !important;
    }
  }
}

// Global diagram styles.
:global {
  // Nodes.
  .node rect,
  .node polygon,
  .node circle,
  .node ellipse,
  .node path {
    fill: var(--mermaid-node-fill);
    stroke: var(--mermaid-node-stroke);
    stroke-width: var(--mermaid-node-stroke-width, 1.5px);
    stroke-dasharray: var(--mermaid-node-dash-array, 4 2);
    transition: all var(--mermaid-transition-duration, 0.3s) var(--mermaid-transition-easing, ease);
  }

  // Node hover: dashed to solid.
  .node:hover rect,
  .node:hover polygon,
  .node:hover circle,
  .node:hover ellipse {
    stroke: var(--mermaid-highlight-stroke);
    stroke-width: 2px;
    stroke-dasharray: none;
    filter: var(--mermaid-highlight-glow);
  }

  // Node text: override Mermaid inline styles with higher priority.
  .node .label,
  .nodeLabel {
    font-family: 'Inter', 'Segoe UI', -apple-system, sans-serif;
    font-size: 13px;
    font-weight: 500;
    letter-spacing: 0.2px;
    color: var(--mermaid-node-text) !important;
  }
  
  // Force override Mermaid's inline white text.
  .nodeLabel span,
  .nodeLabel p,
  .nodeLabel div,
  .node .label span,
  .node .label p,
  .node .label div {
    color: var(--mermaid-node-text) !important;
  }
  
  .node text,
  .node tspan,
  .label text,
  .label tspan {
    fill: var(--mermaid-node-text) !important;
  }
  
  .node foreignObject div,
  .node foreignObject span,
  .node foreignObject p,
  foreignObject div,
  foreignObject span,
  foreignObject p {
    color: var(--mermaid-node-text) !important;
  }
  
  // Target Mermaid-generated IDs.
  [id^="mermaid-"] .label,
  [id^="mermaid-"] .nodeLabel,
  [id^="mermaid-"] .node .label {
    color: var(--mermaid-node-text) !important;
  }
  
  [id^="mermaid-"] .label text,
  [id^="mermaid-"] .label tspan,
  [id^="mermaid-"] span,
  [id^="mermaid-"] p {
    fill: var(--mermaid-node-text) !important;
    color: var(--mermaid-node-text) !important;
  }

  .node rect {
    rx: var(--mermaid-node-radius, 6px);
    ry: var(--mermaid-node-radius, 6px);
  }

  // Edges.
  .edgePath path.path {
    stroke: var(--mermaid-edge-stroke);
    stroke-width: var(--mermaid-edge-stroke-width, 1.5px);
    stroke-linecap: round;
    stroke-linejoin: round;
    transition: all var(--mermaid-transition-duration, 0.3s) var(--mermaid-transition-easing, ease);
  }

  .edgePath:hover path.path {
    stroke: var(--mermaid-highlight-stroke);
    stroke-width: 2.5px;
    filter: var(--mermaid-highlight-glow);
  }

  // Arrowheads.
  .edgePath marker path {
    fill: var(--mermaid-arrow-color);
  }

  // Edge labels.
  .edgeLabel {
    background-color: var(--mermaid-edge-label-bg);
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 11px;
    font-weight: 500;
    
    rect {
      fill: var(--mermaid-edge-label-bg);
      stroke: var(--mermaid-edge-label-border);
      stroke-width: 1px;
      stroke-dasharray: 3 2;
      rx: 4px;
      ry: 4px;
      transition: all var(--mermaid-transition-duration, 0.3s) ease;
    }

    &:hover rect {
      stroke: var(--mermaid-highlight-stroke);
      stroke-dasharray: none;
    }

    .label {
      fill: var(--mermaid-edge-label-text);
    }
  }

  // Subgraphs / clusters.
  .cluster rect {
    fill: var(--mermaid-cluster-fill);
    stroke: var(--mermaid-cluster-stroke);
    stroke-width: var(--mermaid-cluster-stroke-width, 1px);
    stroke-dasharray: var(--mermaid-cluster-dash-array, 5 3);
    rx: var(--mermaid-cluster-radius, 8px);
    ry: var(--mermaid-cluster-radius, 8px);
    transition: all var(--mermaid-transition-duration, 0.3s) ease;
  }

  .cluster:hover rect {
    stroke: var(--mermaid-highlight-stroke);
    stroke-dasharray: none;
    stroke-width: 1.5px;
  }

  .cluster .label {
    fill: var(--mermaid-cluster-text);
    font-weight: 600;
    font-size: 12px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  // Sequence diagram.
  .actor {
    fill: var(--mermaid-actor-fill);
    stroke: var(--mermaid-actor-stroke);
    stroke-width: 1.5px;
    rx: 6px;
    ry: 6px;
    transition: all var(--mermaid-transition-duration, 0.3s) ease;
  }

  .actor:hover {
    stroke: var(--mermaid-highlight-stroke);
    stroke-width: 2px;
  }

  .actor-line {
    stroke: var(--mermaid-signal-stroke);
    stroke-width: 1px;
    stroke-dasharray: 4 4;
  }

  .messageLine0,
  .messageLine1 {
    stroke: var(--mermaid-signal-stroke);
    stroke-width: 1.5px;
    transition: stroke-width var(--mermaid-transition-duration, 0.3s) ease;
  }

  .messageLine1 {
    stroke-dasharray: 4 3;
  }

  .messageText {
    fill: var(--mermaid-signal-text);
    font-size: 12px;
    font-weight: 500;
  }

  .note {
    fill: var(--mermaid-note-fill);
    stroke: var(--mermaid-note-stroke);
    stroke-width: 1px;
    stroke-dasharray: 3 2;
    rx: 4px;
    ry: 4px;
  }

  .noteText {
    fill: var(--mermaid-note-text);
    font-size: 11px;
    font-style: italic;
  }

  .loopLine {
    stroke: var(--mermaid-cluster-stroke);
    stroke-width: 1px;
    stroke-dasharray: 4 2;
  }

  .loopText,
  .loopText tspan {
    fill: var(--mermaid-edge-label-text);
    font-size: 11px;
    font-weight: 500;
  }

  .activation0,
  .activation1,
  .activation2 {
    fill: var(--mermaid-activation-fill);
    stroke: var(--mermaid-activation-stroke);
    stroke-width: 1px;
  }

  // Gantt chart.
  .section {
    stroke: var(--mermaid-cluster-stroke);
    stroke-width: 1px;
  }

  .section0,
  .section2 {
    fill: var(--mermaid-section-fill);
  }

  .section1,
  .section3 {
    fill: var(--mermaid-section-alt-fill);
  }

  .task {
    stroke-width: 1.5px;
    rx: 4px;
    ry: 4px;
    transition: all var(--mermaid-transition-duration, 0.3s) ease;
  }

  .task:hover {
    filter: brightness(1.1);
    stroke-width: 2px;
  }

  .done0, .done1, .done2, .done3 {
    fill: var(--mermaid-done-fill);
    stroke: var(--mermaid-done-stroke);
  }

  .active0, .active1, .active2, .active3 {
    fill: var(--mermaid-active-fill);
    stroke: var(--mermaid-active-stroke);
  }

  .crit0, .crit1, .crit2, .crit3 {
    fill: var(--mermaid-crit-fill);
    stroke: var(--mermaid-crit-stroke);
  }

  .taskText,
  .taskTextOutsideRight,
  .taskTextOutsideLeft {
    fill: var(--mermaid-task-text);
    font-size: 11px;
    font-weight: 500;
  }

  .grid .tick line {
    stroke: var(--mermaid-grid-stroke);
    stroke-dasharray: 2 2;
  }

  // Pie chart.
  .pieCircle {
    stroke: var(--mermaid-pie-stroke);
    stroke-width: var(--mermaid-pie-stroke-width, 2px);
    transition: all var(--mermaid-transition-duration, 0.3s) ease;
  }

  .pieCircle:hover {
    filter: brightness(1.1);
    transform: scale(1.02);
    transform-origin: center;
  }

  .pieTitleText {
    fill: var(--mermaid-pie-title-text);
    font-size: 16px;
    font-weight: 600;
  }

  .slice {
    transition: all var(--mermaid-transition-duration, 0.3s) ease;
  }

  .slice:hover {
    opacity: 0.9;
    filter: brightness(1.15);
  }

  .legend text {
    fill: var(--mermaid-pie-legend-text);
    font-size: 12px;
  }

  // Class diagram.
  .classGroup rect {
    fill: var(--mermaid-class-fill);
    stroke: var(--mermaid-class-stroke);
    stroke-width: 1.5px;
    rx: 6px;
    ry: 6px;
  }

  .classGroup:hover rect {
    stroke: var(--mermaid-highlight-stroke);
    stroke-width: 2px;
  }

  .classGroup line {
    stroke: var(--mermaid-class-divider);
    stroke-width: 1px;
  }

  .classLabel {
    fill: var(--mermaid-class-text);
    font-weight: 600;
    font-size: 13px;
  }

  .relation {
    stroke: var(--mermaid-edge-stroke);
    stroke-width: 1.5px;
  }

  .relation:hover {
    stroke: var(--mermaid-highlight-stroke);
    stroke-width: 2px;
  }

  // State diagram.
  .stateGroup rect {
    fill: var(--mermaid-node-fill);
    stroke: var(--mermaid-node-stroke);
    stroke-width: 1.5px;
    rx: 8px;
    ry: 8px;
  }

  .stateGroup:hover rect {
    stroke: var(--mermaid-highlight-stroke);
    stroke-width: 2px;
  }

  .stateGroup .state-title {
    font-weight: 600;
    font-size: 13px;
  }

  .start-state circle,
  .end-state-outer circle {
    fill: var(--mermaid-node-text);
  }

  .end-state-inner circle {
    fill: var(--mermaid-node-fill);
  }

  .composit rect {
    fill: var(--mermaid-cluster-fill);
    stroke-dasharray: 4 2;
  }

  .transition {
    stroke: var(--mermaid-edge-stroke);
    stroke-width: 1.5px;
  }

  .transition:hover {
    stroke: var(--mermaid-highlight-stroke);
    stroke-width: 2px;
  }

  // ER diagram.
  .er.entityBox {
    fill: var(--mermaid-node-fill);
    stroke: var(--mermaid-node-stroke);
    stroke-width: 1.5px;
  }

  .er.entityBox:hover {
    stroke: var(--mermaid-highlight-stroke);
    stroke-width: 2px;
  }

  .er.entityLabel {
    fill: var(--mermaid-node-text);
    font-weight: 600;
  }

  .er.attributeBoxOdd,
  .er.attributeBoxEven {
    fill: var(--mermaid-cluster-fill);
    stroke: var(--mermaid-cluster-stroke);
    stroke-width: 1px;
  }

  .er.relationshipLine {
    stroke: var(--mermaid-edge-stroke);
    stroke-width: 1.5px;
  }

  .er.relationshipLabel {
    fill: var(--mermaid-edge-label-text);
    font-size: 11px;
  }

  // Git diagram.
  .commit-id,
  .commit-msg {
    fill: var(--mermaid-commit-text);
    font-family: 'JetBrains Mono', 'Fira Code', monospace;
    font-size: 11px;
  }

  .branch-label {
    fill: var(--mermaid-branch-label);
    font-weight: 600;
    font-size: 12px;
  }

  .commit {
    stroke-width: 2px;
  }

  .commit:hover {
    stroke-width: 3px;
    filter: brightness(1.2);
  }

  // Interaction states.
  .selected rect,
  .selected polygon,
  .selected circle,
  .selected ellipse {
    stroke: var(--mermaid-selected-stroke) !important;
    stroke-width: 2.5px !important;
    filter: var(--mermaid-highlight-glow);
  }

  .highlight rect,
  .highlight polygon,
  .highlight circle,
  .highlight ellipse {
    stroke: var(--mermaid-warning) !important;
    stroke-width: 2px !important;
    stroke-dasharray: 4 2;
  }

  .error rect,
  .error polygon,
  .error circle {
    stroke: var(--mermaid-error) !important;
    stroke-width: 2px !important;
    stroke-dasharray: 4 2;
    fill: var(--mermaid-error-bg) !important;
  }

  .success rect,
  .success polygon,
  .success circle {
    stroke: var(--mermaid-success) !important;
    stroke-width: 2px !important;
  }

  // Label styles.
  .label-container {
    fill: var(--mermaid-edge-label-bg);
    stroke: var(--mermaid-edge-label-border);
    stroke-width: 1px;
    rx: 4px;
    ry: 4px;
  }

  .label foreignObject {
    overflow: visible;
  }

  .label div {
    color: var(--mermaid-node-text);
    font-family: 'Inter', 'Segoe UI', -apple-system, sans-serif;
    font-size: 13px;
    line-height: 1.4;
  }

  .label code,
  .label pre {
    font-family: 'JetBrains Mono', 'Fira Code', monospace;
    font-size: 11px;
    background: var(--element-bg-base, rgba(255, 255, 255, 0.05));
    padding: 2px 6px;
    border-radius: 3px;
  }
}

// Print styles.
@media print {
  :global {
    .node rect,
    .node polygon,
    .node circle {
      fill: white !important;
      stroke: #333 !important;
      stroke-width: 1px !important;
    }

    .edgePath path.path {
      stroke: #333 !important;
      stroke-width: 1px !important;
    }

    .label,
    .nodeLabel {
      fill: #000 !important;
      color: #000 !important;
    }
  }
}

// Animations.
@keyframes diagram-pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.6; }
}

@keyframes diagram-dash {
  to { stroke-dashoffset: -20; }
}

:global {
  .animated-path {
    animation: diagram-dash 1s linear infinite;
  }

  .pulsing {
    animation: diagram-pulse 2s ease-in-out infinite;
  }
}
