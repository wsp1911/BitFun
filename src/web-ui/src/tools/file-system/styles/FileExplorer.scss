@use '../../../component-library/styles/tokens' as *;
@use '../../../component-library/styles/_extended-mixins' as mixins;

$_node-height: 24px;
$_node-padding-y: 3px;
$_node-padding-x: 8px;
$_icon-size: 16px;
$_indent-width: 8px;

.bitfun-file-explorer {
  height: 100%;
  overflow: hidden;
  @include mixins.flex-layout(column, stretch, start, 0);
  background: var(--color-bg-secondary);
  border-radius: $size-radius-sm;
  position: relative;

  &--empty {
    justify-content: center;
    align-items: center;
  }
}

.bitfun-file-explorer__toolbar {
  position: absolute;
  top: $size-gap-2;
  right: $size-gap-1;
  @include mixins.flex-layout(row, center, center, 2px);
  z-index: 10;
  opacity: 0;
  pointer-events: none;
  transition: opacity $motion-base $easing-standard;
  background: transparent;
  border: none;
  border-radius: 0;
  padding: 0;
  box-shadow: none;
  
  &--visible {
    opacity: 1;
    pointer-events: auto;
  }
  
  .icon-btn {
    flex-shrink: 0;
    width: 24px;
    height: 24px;
    color: var(--color-text-muted);
    
    &:hover {
      color: var(--color-text-primary);
      background: rgba(255, 255, 255, 0.08);
    }
    
    svg {
      width: 14px;
      height: 14px;
    }
  }
}

.bitfun-file-explorer__empty {
  text-align: center;
  color: var(--color-text-muted);
  padding: $size-gap-8;
}

.bitfun-file-explorer__empty-icon {
  margin-bottom: $size-gap-4;
  opacity: $opacity-disabled;
}

.bitfun-file-explorer__breadcrumb {
  display: flex;
  align-items: center;
  gap: 1px;
  padding: 4px 8px;
  height: 24px;
  font-size: 11px;
  color: var(--color-text-muted);
  background: linear-gradient(
    180deg,
    rgba(255, 255, 255, 0.025) 0%,
    rgba(255, 255, 255, 0.015) 100%
  );
  overflow: hidden;
  
  transition: all 0.15s ease-out;
}

.bitfun-file-explorer__breadcrumb-separator {
  color: var(--color-text-disabled);
  flex-shrink: 0;
  opacity: 0.4;
  margin: 0 1px;
}

.bitfun-file-explorer__breadcrumb-item {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  max-width: 100px;
  padding: 2px 2px 3px;
  border-radius: 3px;
  transition: all $motion-fast $easing-standard;
  
  &--clickable {
    cursor: pointer;
    
    &:hover {
      color: var(--color-text-primary);
      background: rgba(255, 255, 255, 0.08);
    }
  }
  
  &:last-child {
    color: var(--color-text-secondary);
    background: rgba(255, 255, 255, 0.04);
  }
}

.bitfun-file-explorer__tree {
  flex: 1;
  overflow-y: auto;
  overflow-x: hidden;
  padding: $size-gap-2 0;
  -webkit-overflow-scrolling: touch;
  scroll-behavior: smooth;

}

.bitfun-file-explorer__node {
  user-select: none;
  
  &--git-modified,
  &--git-staged {
    .bitfun-file-explorer__node-name {
      color: rgb(229, 192, 123) !important;
    }
  }
  
  &--git-added,
  &--git-untracked {
    .bitfun-file-explorer__node-name {
      color: rgb(115, 191, 105) !important;
    }
  }
  
  &--git-deleted {
    .bitfun-file-explorer__node-name {
      color: rgb(229, 109, 109) !important;
      text-decoration: line-through;
    }
  }
  
  &--git-conflicted {
    .bitfun-file-explorer__node-name {
      color: rgb(232, 151, 91) !important;
      font-weight: $font-weight-medium;
    }
  }
  
  &--git-renamed {
    .bitfun-file-explorer__node-name {
      color: rgb(180, 142, 217) !important;
    }
  }
}

.bitfun-file-explorer__node-content {
  @include mixins.flex-layout(row, center, start, $size-gap-1);
  padding: $_node-padding-y $_node-padding-x;
  cursor: pointer;
  min-height: $_node-height;
  border-radius: $size-radius-sm;
  margin: 0 $size-gap-1;
  position: relative;
  
  background: transparent;
  transition: all $motion-base $easing-standard;
  color: var(--color-text-secondary);
  
  &:focus {
    outline: none;
    background: var(--element-bg-base);
    color: var(--color-text-primary);
  }
  
  &:focus-visible {
    outline: 1px solid var(--color-accent-500);
    outline-offset: -1px;
  }

  &:hover {
    background: var(--element-bg-base);
    color: var(--color-text-primary);
  }

  &--selected {
    background: $git-color-branch-bg;
    color: $git-color-branch;

    .bitfun-file-explorer__node-name {
      color: $git-color-branch;
      font-weight: $font-weight-medium;
    }

    &:hover {
      background: $git-color-branch-bg-hover;
      color: $git-color-branch;
    }
  }

  &--compressed {
    font-style: italic;

    &:hover {
      background: var(--element-bg-base);
    }
  }

  &--highlighted {
    background: $git-color-branch-bg !important;
    animation: file-node-highlight-fade 2s ease-out forwards;
    
    .bitfun-file-explorer__node-name {
      color: $git-color-branch;
      font-weight: $font-weight-medium;
    }
  }
}

@keyframes file-node-highlight-fade {
  0% {
    background: rgba(var(--color-accent-rgb, 99, 102, 241), 0.2);
  }
  30% {
    background: $git-color-branch-bg;
  }
  100% {
    background: transparent;
  }
}

.bitfun-file-explorer__expand-icon {
  @include mixins.flex-layout(row, center, center, 0);
  @include mixins.size($_icon-size);
  transition: transform $motion-fast $easing-standard;
  color: var(--color-text-muted);
  flex-shrink: 0;
  min-width: $_icon-size;
}

.bitfun-file-explorer__icon {
  @include mixins.flex-layout(row, center, center, 0);
  flex-shrink: 0;
  transition: all $motion-fast $easing-standard;
  min-width: $_icon-size;

  &--folder {
    color: $git-color-branch;
  }

  &--folder-open {
    color: var(--color-accent-500);
  }

  &--file {
    color: var(--color-text-muted);
  }

  &--image {
    color: #5ba882;
  }

  &--code {
    color: #9678c4;
  }

  &--javascript {
    color: #c9b35c;
  }

  &--typescript {
    color: #5a8fc8;
  }

  &--react {
    color: #5cb8c8;
  }

  &--vue {
    color: #5fb88a;
  }

  &--python {
    color: #5a88b8;
  }

  &--rust {
    color: #c49a6a;
  }

  &--go {
    color: #4aa8b8;
  }

  &--java {
    color: #c8985a;
  }

  &--c-cpp {
    color: #6a9ac8;
  }

  &--html {
    color: #c87a5a;
  }

  &--css {
    color: #5a90b8;
  }

  &--sass {
    color: #b87a98;
  }

  &--config {
    color: #b8a858;
  }

  &--json {
    color: #b8a858;
  }

  &--markdown {
    color: #5a7aaa;
  }

  &--text {
    color: #8a8a98;
  }

  &--database {
    color: #b89858;
  }

  &--font {
    color: #9678c4;
  }

  &--audio {
    color: #b8789a;
  }

  &--video {
    color: #b87878;
  }

  &--archive {
    color: #a88858;
  }
}

.bitfun-file-explorer__node-wrapper {
  @include mixins.flex-layout(row, center, start, $size-gap-2);
  flex: 1;
  min-width: 0;
}

.bitfun-file-explorer__node-name {
  flex: 1;
  font-size: $font-size-sm;
  font-weight: $font-weight-normal;
  @include mixins.text-ellipsis;
  position: relative;
  z-index: 2;
  color: inherit;
}

.bitfun-file-explorer__rename-input-wrapper {
  flex: 1;
  min-width: 0;
  z-index: 10;
  
  .bitfun-input-wrapper {
    gap: 0;
    border: none;
    
    .bitfun-input-container {
      height: 26px;
      padding: 0 8px;
      background: rgba(15, 15, 15, 0.95);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border: none !important;
      box-shadow: 
        0 0 0 1px rgba(59, 130, 246, 0.8),
        0 2px 8px rgba(0, 0, 0, 0.4);
      
      &:hover {
        background: rgba(10, 10, 10, 0.98);
        box-shadow: 
          0 0 0 1px rgba(59, 130, 246, 0.9),
          0 2px 8px rgba(0, 0, 0, 0.4);
      }
      
      &:focus-within {
        background: rgba(8, 8, 8, 1);
        box-shadow: 
          0 0 0 1px rgba(59, 130, 246, 1),
          0 4px 12px rgba(0, 0, 0, 0.5);
      }
    }
    
    .bitfun-input {
      font-size: $font-size-sm;
      color: var(--color-text-primary);
      font-weight: $font-weight-medium;
      border: none !important;
      outline: none !important;
    }
    
    .bitfun-input-prefix {
      color: rgba(59, 130, 246, 0.8);
    }
  }
}

.bitfun-file-explorer__compressed-path {
  font-style: italic;
  opacity: 0.85;
  color: var(--color-text-muted);
}

.bitfun-file-explorer__node-size {
  font-size: $font-size-xs;
  color: var(--color-text-muted);
  opacity: 0.7;
  flex-shrink: 0;
  position: relative;
  z-index: 2;
}

.bitfun-file-explorer__node-modified {
  font-size: $font-size-xs;
  color: var(--color-text-muted);
  opacity: 0.7;
  flex-shrink: 0;
  position: relative;
  z-index: 2;
}

.bitfun-file-explorer__node-actions {
  @include mixins.flex-layout(row, center, start, $size-gap-1);
  opacity: 0;
  transition: opacity $motion-fast $easing-standard;
  position: relative;
  z-index: 2;

  .bitfun-file-explorer__node-content:hover & {
    opacity: 1;
  }
}

.bitfun-file-explorer__node-children {
  // Indentation is computed in JS via paddingLeft; avoid additional spacing here.
  position: relative;
}

.bitfun-file-explorer__empty-message {
  @include mixins.flex-layout(row, center, center, 0);
  padding: $size-gap-8;
  color: var(--color-text-muted);
  font-style: italic;
}

@include mixins.respond-to('mobile') {
  .bitfun-file-explorer__node-content {
    padding: 6px $_node-padding-x;
    min-height: 32px;
  }

  .bitfun-file-explorer__node-name {
    font-size: $font-size-base;
  }

  .bitfun-file-explorer__node-size,
  .bitfun-file-explorer__node-modified {
    display: none;
  }
}

// .file-explorer { @extend .bitfun-file-explorer; }
// .file-tree { @extend .bitfun-file-explorer__tree; }
// .file-tree-node { @extend .bitfun-file-explorer__node; }
// .node-content { @extend .bitfun-file-explorer__node-content; }
