@use '../../../../component-library/styles/tokens' as *;
@use '../../../../component-library/styles/_extended-mixins' as mixins;

$size-gap-1-5: 6px !default;
$size-radius-xs: 4px !default;
$opacity-secondary: 0.7 !default;
$opacity-high: 0.8 !default;
$border-subtle: rgba(255, 255, 255, 0.06) !default;

.bitfun-git-panel {
  display: flex;
  flex-direction: column;
  height: 100%;
  background: var(--color-bg-primary);
  color: var(--color-text-primary);
  font-family: $font-family-sans;
  container-type: inline-size;
  container-name: git-panel;

  &__icon {
    &--branch {
      color: #60a5fa;
      transition: color $motion-base $easing-standard;
    }

    &--changes {
      color: $git-color-changes;
    }

    &--staged {
      color: $git-color-staged;
    }
  }

  &__branch-item:hover &__icon--branch {
    color: #7ab8ff;
  }

  &__refresh-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 24px;
    height: 24px;
    background: transparent;
    border: none;
    padding: 0;
    color: var(--color-text-secondary);
    cursor: pointer;
    transition: color $motion-base $easing-standard;

    &:hover {
      color: var(--color-text-primary);
    }

    &:disabled {
      opacity: $opacity-disabled;
      cursor: default;
    }

    svg {
      transition: transform $motion-base $easing-standard;
    }

    &--spinning svg {
      animation: bitfun-git-panel-spin 1s linear infinite;
    }
  }

  &__operation-indicator {
    display: flex;
    align-items: center;
  }

  &__content {
    flex: 1;
    display: flex;
    flex-direction: column;
    overflow: hidden;
    padding: $size-gap-2 0;
    min-height: 0;
  }

  &--not-repository &__content {
    justify-content: center;
    align-items: center;
  }

  &__section {
    margin-bottom: $size-gap-1;
    flex-shrink: 0;

    &:last-child {
      flex: 1;
      display: flex;
      flex-direction: column;
      margin-bottom: 0;
      min-height: 0;
      flex-shrink: 1;
    }
  }

  &__section-header {
    display: flex;
    align-items: center;
    gap: $size-gap-2;
    padding: $size-gap-2 $size-gap-4;
    font-size: $font-size-sm;
    font-weight: $font-weight-medium;
    color: var(--color-text-secondary);
    user-select: none;

    &--fixed {
      cursor: default;
    }
  }

  &__section-content {
    padding: 0;
    flex: 1;
    display: flex;
    flex-direction: column;
    overflow: visible;
    min-height: 0;
  }



  &__quick-actions {
    display: flex;
    flex-direction: column;
    gap: $size-gap-2;
    flex-shrink: 0;
  }

  &__action-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: $size-gap-3;
    padding: $size-gap-2 $size-gap-3;
    background: $element-bg-subtle;
    border-radius: $size-radius-base;
    transition: background $motion-base $easing-standard;

    &:hover {
      background: var(--element-bg-base);
    }
  }

  &__action-info {
    display: flex;
    align-items: center;
    gap: $size-gap-2;
    flex: 1;
    min-width: 0;
    font-size: $font-size-sm;
    color: var(--color-text-secondary);
  }

  &__info-text {
    font-weight: $font-weight-normal;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  &__sync-item {
    display: flex;
    align-items: center;
    gap: 4px;
    font-size: $font-size-xs;
    font-weight: $font-weight-medium;
    margin-left: $size-gap-2;
    padding: 2px 6px;
    border-radius: $size-radius-sm;
    transition: all $motion-base $easing-standard;

    &--push {
      color: $git-color-push;
      background: $git-color-push-bg;
      
      &:hover {
        background: $git-color-push-bg-hover;
      }
    }

    &--pull {
      color: $git-color-pull;
      background: $git-color-pull-bg;
      
      &:hover {
        background: $git-color-pull-bg-hover;
      }
    }
  }

  &__staged-info {
    display: flex;
    align-items: center;
    gap: 4px;
    font-size: $font-size-xs;
    font-weight: $font-weight-normal;
    margin-left: $size-gap-2;
    color: $git-color-staged;
  }

  &__action-buttons {
    display: flex;
    gap: $size-gap-2;
    flex-shrink: 0;
  }

  &__tabs {
    display: flex;
    gap: 4px;
    padding: $size-gap-2 $size-gap-3;
    margin-bottom: 0;
    flex-shrink: 0;
    position: relative;
    background: transparent;

    &::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: $size-gap-3;
      right: $size-gap-3;
      height: 1px;
      background: var(--border-subtle, #{$border-subtle});
    }

    &--with-border {
      border-top: 1px solid $border-base;
      padding-top: $size-gap-2;
      margin-top: $size-gap-2;
    }
  }

  &__tab {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
    padding: 7px $size-gap-3;
    background: transparent;
    border: none;
    border-radius: 6px;
    font-size: $font-size-sm;
    font-weight: $font-weight-normal;
    color: var(--color-text-muted);
    cursor: pointer;
    transition: all 0.15s ease;
    white-space: nowrap;
    position: relative;

    &:hover {
      color: var(--color-text-secondary);
      background: var(--element-bg-subtle, #{$element-bg-subtle});
    }

    &--active {
      color: var(--color-text-primary);
      font-weight: $font-weight-medium;
      background: var(--element-bg-base, #{$element-bg-subtle});

      &::after {
        content: '';
        position: absolute;
        bottom: -$size-gap-2;
        left: 25%;
        right: 25%;
        height: 2px;
        background: var(--color-text-primary);
        border-radius: 1px;
        opacity: 0.5;
      }

      .bitfun-git-panel__tab-icon {
        opacity: 1;
      }

      &:hover {
        background: var(--element-bg-soft, #{$element-bg-subtle});
      }
    }
  }

  &__tab-icon {
    flex-shrink: 0;
    opacity: 0.5;
    transition: opacity 0.15s ease;
  }

  &__tab-text {
    overflow: hidden;
    text-overflow: ellipsis;
  }

  &__tab-content {
    flex: 1;
    overflow-y: auto;
    overflow-x: hidden;
    min-height: 0;
  }

  &__search-area {
    display: block;
    flex-shrink: 0;
    padding: $size-gap-2 $size-gap-3;
    background: var(--panel-bg-base);
    position: relative;
    z-index: $z-dropdown;
    overflow: visible;
  }

  &__search-row {
    display: flex;
    align-items: center;
    gap: $size-gap-2;
    flex-shrink: 0;
  }

  &__icon-button {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 32px;
    height: 32px;
    padding: 0;
    background: transparent;
    border: none;
    border-radius: $size-radius-base;
    color: var(--color-text-secondary);
    cursor: pointer;
    transition: all $motion-base $easing-standard;
    flex-shrink: 0;

    &:hover:not(:disabled) {
      background: transparent;
      color: var(--color-text-primary);
    }

    &:active:not(:disabled) {
      transform: scale(0.95);
    }

    &:disabled,
    &--disabled {
      opacity: 0.4;
      cursor: default;
    }
  }

  &__search-box {
    flex: 1;
    min-width: 0;
    flex-shrink: 0;

    .search__wrapper {
      background: transparent;
      border: 1px dashed var(--border-medium, #{$border-medium});
      border-radius: $size-radius-base;
      transition: all $motion-base $easing-standard;
    }

    &:hover:not(.search--focused) .search__wrapper {
      border-style: solid;
      background: var(--element-bg-base);
    }

    &.search--focused .search__wrapper {
      border-style: solid;
      border-color: var(--border-medium, #{$border-medium});
      background: var(--element-bg-base);
    }
  }

  &__search-icon {
    flex-shrink: 0;
    color: var(--border-medium, #{$border-medium});
    transition: color $motion-fast $easing-standard;
  }

  &__search-input {
    flex: 1;
    background: transparent;
    border: none;
    outline: none;
    color: var(--color-text-primary);
    font-size: $font-size-sm;
    font-family: $font-family-sans;
    padding: 0;

    &::placeholder {
      color: var(--color-text-muted);
    }

    &:focus {
      outline: none !important;
    }

    &:focus-visible {
      outline: none !important;
    }
  }

  &__search-clear {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 2px;
    background: transparent;
    border: none;
    border-radius: $size-radius-sm;
    color: var(--color-text-muted);
    cursor: pointer;
    transition: all $motion-base $easing-standard;
    flex-shrink: 0;

    &:hover {
      background: $element-bg-subtle;
      color: var(--color-text-primary);
    }
  }

  &__commit-section {
    display: flex;
    flex-direction: column;
    gap: $size-gap-2;
    padding: 0 $size-gap-3 $size-gap-3;
  }

  &__status-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: $size-gap-2;
    padding: $size-gap-2 0 0 0;
  }

  &__status-item {
    display: flex;
    align-items: center;
    gap: $size-gap-1;
    color: var(--color-text-secondary);
  }

  &__status-branch {
    font-family: $font-family-mono;
    font-size: $font-size-sm;
    font-weight: $font-weight-medium;
    color: var(--color-text-primary);
    max-width: 120px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }

  &__status-badges {
    display: flex;
    align-items: center;
    gap: $size-gap-1;
    flex: 1;
    justify-content: flex-start;
    margin-left: $size-gap-2;
  }

  &__status-actions {
    display: flex;
    align-items: center;
    gap: 2px;
    margin-left: auto;
  }

  &__status-badge {
    display: inline-flex;
    align-items: center;
    gap: 4px;
    padding: 2px 6px;
    border-radius: $size-radius-sm;
    font-size: 10px;
    font-weight: $font-weight-medium;
    font-family: $font-family-mono;
    color: var(--color-text-secondary);
    background: var(--bg-tertiary, rgba(128, 128, 128, 0.08));

    &::before {
      content: '';
      width: 6px;
      height: 6px;
      border-radius: 50%;
      flex-shrink: 0;
    }

    &--staged::before {
      background: #6db37e;
    }

    &--unstaged::before {
      background: #c9a050;
    }

    &--ahead::before {
      background: #6199c4;
    }

    &--behind::before {
      background: #c47878;
    }
  }

  &__commit-input {
    width: 100%;

    .bitfun-textarea__field {
      min-height: 60px;
      padding: $size-gap-2 $size-gap-3;
      padding-right: 40px;
      background: transparent;
      border: 1px dashed var(--border-medium, #{$border-medium});
      border-radius: $size-radius-base;
      color: var(--color-text-primary);
      font-size: $font-size-sm;
      font-family: $font-family-sans;
      transition: all $motion-base $easing-standard;
      resize: none !important;
      vertical-align: top;
      outline: none !important;

      &::placeholder {
        color: var(--color-text-muted);
      }

      &:hover:not(:focus):not(:disabled) {
        background: transparent;
        border-style: solid;
      }

      &:focus {
        outline: none !important;
        border-style: solid;
        border-color: var(--border-medium, #{$border-medium});
        background: transparent;
      }

      &:focus-visible {
        outline: none !important;
      }

      &:disabled {
        opacity: 0.5;
        cursor: default;
        background: transparent;
      }
    }
  }

  &__commit-input-wrapper {
    position: relative;
    width: 100%;
    border-radius: $size-radius-base;
    isolation: isolate;
    background: transparent;

    &:hover .bitfun-git-panel__ai-btn:not(:disabled) {
      color: #A855F7;
    }

    &--generating {
      &::before {
        content: '';
        position: absolute;
        top: -2px;
        left: -2px;
        right: -2px;
        bottom: -2px;
        background: linear-gradient(
          90deg,
          #a855f7,
          #ec4899,
          #f97316,
          #eab308,
          #22c55e,
          #06b6d4,
          #3b82f6,
          #a855f7
        );
        background-size: 400% 100%;
        border-radius: calc($size-radius-base + 2px);
        z-index: -2;
        animation: bitfun-git-panel-gradient-flow 3s linear infinite;
      }

      &::after {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: var(--panel-bg, #1a1a1a);
        border-radius: $size-radius-base;
        z-index: -1;
      }

      .bitfun-git-panel__commit-input .bitfun-textarea__field {
        border-color: transparent;
        background: var(--element-bg-base, #2a2a2a);
      }
    }
  }

  @keyframes bitfun-git-panel-gradient-flow {
    0% {
      background-position: 0% 50%;
    }
    100% {
      background-position: 400% 50%;
    }
  }

  &__ai-btn {
    position: absolute;
    right: 8px;
    top: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 28px;
    height: 28px;
    padding: 0;
    background: transparent;
    border: none;
    border-radius: $size-radius-sm;
    color: var(--border-medium, #{$border-medium});
    cursor: pointer;
    transition: all $motion-fast $easing-standard;

    &:hover:not(:disabled) {
      color: #A855F7;
      background: rgba(168, 85, 247, 0.1);
    }

    &:active:not(:disabled) {
      opacity: 0.7;
    }

    &:disabled {
      opacity: 0.4;
      cursor: default;
    }

    &--loading {
      animation: bitfun-git-panel-sparkle 1s ease-in-out infinite;
    }

    &--cancel {
      &:hover {
        background: rgba(250, 204, 21, 0.1);
      }
    }
  }

  &__cancel-ring {
    width: 14px;
    height: 14px;
    border: 2px solid #FACC15;
    border-radius: 50%;
    animation: bitfun-git-panel-breathing-ring 1.5s ease-in-out infinite;
  }

  @keyframes bitfun-git-panel-breathing-ring {
    0%, 100% {
      opacity: 0.4;
      transform: scale(0.9);
      box-shadow: 0 0 0 0 rgba(250, 204, 21, 0);
    }
    50% {
      opacity: 1;
      transform: scale(1);
      box-shadow: 0 0 8px 2px rgba(250, 204, 21, 0.4);
    }
  }

  &__commit-buttons {
    display: flex;
    gap: $size-gap-2;
    margin-top: $size-gap-2;
  }

  &__commit-btn {
    flex: 1;
  }

  &__review-btn {
    flex-shrink: 0;
    padding: 0 10px !important;
    
    svg {
      color: var(--color-text-secondary);
      transition: color $motion-base $easing-standard;
    }

    &:hover:not(:disabled) svg {
      color: #7096c4;
    }
  }

  @keyframes bitfun-git-panel-sparkle {
    0%, 100% {
      color: #A855F7;
    }
    50% {
      color: #D8B4FE;
      filter: drop-shadow(0 0 4px rgba(168, 85, 247, 0.8));
    }
  }

  &__list {
    display: flex;
    flex-direction: column;
    gap: 1px;
  }

  &__list-header {
    padding: $size-gap-1 $size-gap-2;
    font-size: $font-size-xs;
    font-weight: $font-weight-medium;
    color: var(--color-text-muted);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    border-radius: $size-radius-sm;

    &:first-child {
      margin-top: 0;
    }

    &--collapsible {
      display: flex;
      align-items: center;
      gap: $size-gap-1;
      cursor: pointer;
      transition: all $motion-base $easing-standard;
      user-select: none;

      &:hover {
        background: var(--element-bg-soft);
        color: var(--color-text-secondary);

        .bitfun-git-panel__checkbox-btn {
          width: 18px;
          margin-right: $size-gap-1;
          opacity: 1;
        }
      }

      &--has-selection {
        .bitfun-git-panel__checkbox-btn {
          width: 18px;
          margin-right: $size-gap-1;
          opacity: 1;
        }
      }

      svg {
        flex-shrink: 0;
        transition: transform $motion-base $easing-standard;
        opacity: 0.7;
      }

      span {
        flex: 1;
      }
    }
  }

  &__list-item {
    display: flex;
    align-items: center;
    gap: $size-gap-1;
    padding: $size-gap-1 $size-gap-3;
    font-size: $font-size-sm;
    color: var(--color-text-secondary);
    background: transparent;
    border: none;
    border-radius: $size-radius-sm;
    cursor: pointer;
    transition: all $motion-base $easing-standard;

    &:hover {
      background: var(--element-bg-base);
      color: var(--color-text-primary);
    }
  }

  &__file-item {
    position: relative;

    &:hover {
      .bitfun-git-panel__checkbox-btn {
        width: 18px;
        margin-right: $size-gap-1;
        opacity: 1;
      }

      .bitfun-git-panel__file-action-btn {
        visibility: visible;
        opacity: 1;
        pointer-events: auto;
      }

      .bitfun-git-panel__list-item-text {
        padding-right: 30px;
      }

      .bitfun-git-panel__file-status-badge {
        margin-right: 30px;
      }
    }

    &--selected {
      .bitfun-git-panel__checkbox-btn {
        width: 18px;
        margin-right: $size-gap-1;
        opacity: 1;
      }
    }

    &--clickable {
      cursor: pointer;
      transition: background-color $motion-base $easing-standard;
      border-radius: $size-radius-sm;

      &:hover {
        background: var(--element-bg-base);
      }

      &:active {
        background: var(--element-bg-active);
      }
    }
  }

  &__file-action-btn {
    position: absolute;
    right: $size-gap-2;
    top: 50%;
    transform: translateY(-50%);
    display: flex;
    align-items: center;
    justify-content: center;
    width: 24px;
    height: 24px;
    padding: 0;
    background: transparent;
    border: none;
    border-radius: $size-radius-sm;
    color: var(--color-text-muted);
    cursor: pointer;
    flex-shrink: 0;
    visibility: hidden;
    opacity: 0;
    pointer-events: none;
    transition: all $motion-fast $easing-standard, visibility $motion-fast $easing-standard;

    &:hover {
      background: $element-bg-medium;
      color: var(--color-error);
    }

    &:disabled {
      opacity: 0.3;
      cursor: default;
    }
  }

  &__list-item-text {
    flex: 1;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    font-family: $font-family-sans;
    font-size: $font-size-sm;
    font-weight: $font-weight-normal;
    color: inherit;
  }

  &__branch-item &__list-item-text {
    font-size: $font-size-sm;
    font-weight: $font-weight-normal;
  }

  &__file-name {
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    font-family: $font-family-mono;
    font-size: $font-size-sm;
    font-weight: $font-weight-normal;
    color: var(--color-text-primary);
    flex-shrink: 0;
  }

  &__file-dir {
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    font-family: $font-family-mono;
    font-size: $font-size-sm;
    font-weight: $font-weight-normal;
    color: var(--color-text-secondary);
    opacity: 0.6;
    margin-left: 8px;
    flex: 1;
    min-width: 0;
  }

  &__file-status-badge {
    display: flex;
    align-items: center;
    justify-content: center;
    min-width: 14px;
    font-size: 11px;
    font-weight: $font-weight-semibold;
    font-family: $font-family-mono;
    flex-shrink: 0;
    line-height: 1;
    transition: all $motion-base $easing-standard;
  }

  &__file-status-indicator {
    &--modified {
      color: var(--color-warning);
    }

    &--added {
      color: var(--color-success);
    }

    &--deleted {
      color: var(--color-error);
    }

    &--renamed {
      color: var(--color-info);
    }
  }

  &__checkbox-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 0;
    height: 18px;
    padding: 0;
    margin: 0;
    background: transparent;
    border: none;
    border-radius: 50%;
    cursor: pointer;
    flex-shrink: 0;
    overflow: hidden;
    transition: width $motion-fast $easing-standard, 
                opacity $motion-fast $easing-standard,
                margin $motion-fast $easing-standard;
    opacity: 0;

    &--visible {
      width: 18px;
      margin-right: $size-gap-1;
      opacity: 1;
    }

    &:hover {
      background: rgba(255, 255, 255, 0.08);
    }

    &:active {
      transform: scale(0.95);
    }
  }

  &__checkbox {
    transition: all $motion-fast $easing-standard;

    &--unchecked {
      color: var(--color-text-muted);

      &:hover {
        color: var(--color-text-secondary);
      }
    }

    &--checked {
      color: var(--color-success);
    }

    &--partial {
      color: var(--color-warning);
    }
  }

  &__folder-item {
    display: flex;
    align-items: center;
    gap: $size-gap-1;
    padding: $size-gap-1 $size-gap-3;
    font-size: $font-size-sm;
    color: var(--color-text-secondary);
    background: transparent;
    border: none;
    border-radius: $size-radius-sm;
    cursor: pointer;
    transition: all $motion-base $easing-standard;

    &:hover {
      background: var(--element-bg-base);
      color: var(--color-text-primary);

      .bitfun-git-panel__checkbox-btn {
        width: 18px;
        margin-right: $size-gap-1;
        opacity: 1;
      }
    }

    &--has-selection {
      .bitfun-git-panel__checkbox-btn {
        width: 18px;
        margin-right: $size-gap-1;
        opacity: 1;
      }
    }
  }

  &__folder-toggle {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 20px;
    height: 20px;
    padding: 0;
    background: transparent;
    border: none;
    cursor: pointer;
    flex-shrink: 0;
    transition: all $motion-fast $easing-standard;

    &:hover {
      transform: scale(1.1);
    }
  }

  &__folder-name {
    flex: 1;
    font-family: $font-family-sans;
    font-size: $font-size-sm;
    font-weight: $font-weight-medium;
    color: inherit;
    cursor: pointer;
  }

  &__icon--folder {
    color: var(--color-warning);
  }

  &__file-item {
    &--selected {
      background: rgba(var(--color-success-rgb, 34, 197, 94), 0.1) !important;
      position: relative;
      
      &::before {
        content: '';
        position: absolute;
        left: 0;
        top: 2px;
        bottom: 2px;
        width: 2px;
        background: var(--color-success);
        border-radius: 1px;
      }

      .bitfun-git-panel__list-item-text {
        color: var(--color-text-primary);
      }
    }

    &--nested {
      padding-left: calc($size-gap-3 + 28px);
    }

    &--loading {
      opacity: 0.6;
      pointer-events: none;
      cursor: wait;
      
      &::after {
        content: '';
        position: absolute;
        right: $size-gap-3;
        top: 50%;
        transform: translateY(-50%);
        width: 12px;
        height: 12px;
        border: 2px solid var(--border-medium);
        border-top-color: var(--color-accent-500);
        border-radius: 50%;
        animation: bitfun-git-panel-spin 0.8s linear infinite;
      }
    }
  }

  &__list-header-content {
    display: flex;
    align-items: center;
    gap: $size-gap-1;
    flex: 1;
    cursor: pointer;
    
    &:hover {
      color: var(--color-text-primary);
    }
  }

  &__header-action-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 22px;
    height: 22px;
    padding: 0;
    background: transparent;
    border: none;
    border-radius: $size-radius-sm;
    color: var(--color-text-muted);
    cursor: pointer;
    flex-shrink: 0;
    opacity: 0.5;
    transition: all $motion-fast $easing-standard;

    &:hover:not(:disabled) {
      background: rgba(255, 255, 255, 0.1);
      opacity: 1;
    }

    &:disabled {
      opacity: 0.3;
      cursor: default;
    }

    &--active {
      opacity: 1;
      color: var(--color-success);
      
      &:hover:not(:disabled) {
        background: var(--color-success-bg);
      }
    }
  }

  &__list-empty {
    padding: $size-gap-4 $size-gap-3;
    text-align: center;
    font-size: $font-size-sm;
    color: var(--color-text-muted);
  }

  &__timeline-node {
    position: absolute;
    left: $size-gap-3;
    top: 0;
    bottom: 0;
    width: 20px;
    display: flex;
    flex-direction: column;
    align-items: center;
    cursor: pointer;
    z-index: 1;

    &::before {
      content: '';
      position: absolute;
      top: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 2px;
      height: 50%;
      background: var(--border-medium, #{$border-medium});
    }

    &::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 2px;
      height: 50%;
      background: var(--border-medium, #{$border-medium});
    }

    &--expanded {
      .bitfun-git-panel__timeline-dot {
        background: var(--color-accent-500, #6366f1);
        border-color: var(--color-accent-500, #6366f1);
        box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
      }
    }
  }

  &__timeline-dot {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 10px;
    height: 10px;
    border-radius: 50%;
    background: var(--color-bg-primary);
    border: 2px solid var(--color-text-muted);
    transition: all $motion-fast $easing-standard;
    z-index: 2;

    &:hover {
      border-color: var(--color-text-primary);
    }
  }

  &__commit-item {
    position: relative;
    display: flex;
    flex-direction: column;
    padding-top: $size-gap-2;
    padding-bottom: $size-gap-2;
    padding-left: calc($size-gap-3 + 28px);
    padding-right: $size-gap-3;
    transition: all $motion-base $easing-standard;
    min-height: 44px;

    &:hover {
      background: var(--element-bg-base);

      .bitfun-git-panel__commit-actions {
        visibility: visible;
        opacity: 1;
        pointer-events: auto;
      }

      .bitfun-git-panel__commit-header {
        padding-right: 90px;
      }

      .bitfun-git-panel__timeline-dot {
        border-color: var(--color-text-secondary);
      }
    }

    &--expanded {
      background: $element-bg-subtle;
      padding-bottom: $size-gap-3;
    }

    &:first-child .bitfun-git-panel__timeline-node::before {
      display: none;
    }

    &--last .bitfun-git-panel__timeline-node::after {
      display: none;
    }
  }

  &__commit-header {
    display: flex;
    align-items: center;
    gap: $size-gap-2;
    width: 100%;
    min-height: 0;
  }

  &__commit-info {
    display: flex;
    flex-direction: column;
    gap: 2px;
    flex: 1;
    min-width: 0;
    cursor: pointer;
    justify-content: center;
  }

  &__commit-message {
    font-size: $font-size-sm;
    color: var(--color-text-primary);
    font-weight: $font-weight-normal;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    line-height: 1.4;
  }

  &__commit-meta {
    display: flex;
    align-items: center;
    gap: $size-gap-2;
    font-size: $font-size-xs;
    color: var(--color-text-muted);
    font-weight: $font-weight-normal;
    line-height: 1.4;
  }

  &__commit-author {
    max-width: 100px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }

  &__commit-hash {
    font-family: $font-family-mono;
    padding: 1px 4px;
    background: $element-bg-subtle;
    border-radius: $size-radius-xs;
    font-size: $font-size-xs;
    font-weight: $font-weight-normal;
  }

  &__commit-actions {
    position: absolute;
    right: $size-gap-2;
    top: $size-gap-1;
    display: flex;
    align-items: center;
    gap: 4px;
    visibility: hidden;
    opacity: 0;
    pointer-events: none;
    transition: opacity $motion-base $easing-standard, visibility $motion-base $easing-standard;
    flex-shrink: 0;
  }

  &__commit-action-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 24px;
    height: 24px;
    padding: 0;
    background: transparent;
    border: none;
    border-radius: $size-radius-sm;
    color: var(--color-text-secondary);
    cursor: pointer;
    transition: all $motion-base $easing-standard;

    &:hover {
      background: var(--element-bg-base);
      color: var(--color-text-primary);
    }

    &:disabled {
      opacity: $opacity-disabled;
      cursor: default;
    }
  }

  &__commit-details {
    margin-top: $size-gap-2;
    margin-left: 0;
    padding-top: $size-gap-2;
    border-top: 1px solid $border-subtle;
  }

  &__commit-body {
    margin-bottom: $size-gap-2;
  }

  &__commit-body-text {
    font-size: $font-size-xs;
    color: var(--color-text-secondary);
    white-space: pre-wrap;
    word-wrap: break-word;
    word-break: break-word;
    overflow-wrap: break-word;
    margin: 0;
    padding: 0;
    background: transparent;
    border: none;
    font-family: inherit;
    line-height: 1.5;
  }

  &__commit-files {
    margin-top: $size-gap-2;
  }

  &__commit-files-header {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: $font-size-xs;
    font-weight: $font-weight-semibold;
    color: var(--color-text-muted);
    margin-bottom: 4px;
  }

  &__commit-files-list {
    display: flex;
    flex-direction: column;
    gap: 2px;
  }

  &__commit-file-item {
    display: flex;
    gap: 6px;
    align-items: start;
    padding: $size-gap-1 0;
    background: transparent;
    border-radius: 0;
    transition: background $motion-fast $easing-standard;
    min-width: 0;

    &:hover {
      background: transparent;
    }
  }

  &__commit-file-icon {
    flex-shrink: 0;
    color: var(--color-text-secondary);
    display: flex;
    align-items: center;
    margin-top: 2px;
  }

  &__commit-file-content {
    flex: 1;
    min-width: 0;
    display: flex;
    flex-direction: column;
    gap: $size-gap-1;
  }

  &__commit-file-path {
    font-family: $font-family-mono;
    color: var(--color-text-primary);
    word-break: break-all;
    line-height: 1.4;
    font-size: $font-size-xs;
  }

  &__commit-file-meta {
    display: flex;
    align-items: center;
    gap: 6px;
    flex-wrap: wrap;
  }

  &__commit-file-status {
    padding: 2px 6px;
    border-radius: $size-radius-sm;
    font-size: 9px;
    font-weight: $font-weight-semibold;
    text-transform: uppercase;
    white-space: nowrap;
    line-height: 1.3;
    
    &--modified,
    &--m {
      background: var(--color-warning-bg);
      color: var(--color-warning);
    }

    &--added,
    &--a {
      background: var(--color-success-bg);
      color: var(--color-success);
    }

    &--deleted,
    &--d {
      background: var(--color-error-bg);
      color: var(--color-error);
    }

    &--renamed,
    &--r {
      background: var(--color-info-bg);
      color: var(--color-info);
    }
  }

  &__commit-file-changes {
    display: flex;
    align-items: center;
    gap: 6px;
    font-family: $font-family-mono;
    font-size: 10px;
    white-space: nowrap;
  }

  &__file-additions {
    color: var(--color-success);
    font-weight: $font-weight-medium;
  }

  &__file-deletions {
    color: var(--color-error);
    font-weight: $font-weight-medium;
  }

  &__branch-item {
    position: relative;
    cursor: pointer;
    transition: all $motion-base $easing-standard;
    display: flex;
    align-items: center;
    color: var(--color-text);

    &:hover {
      background: var(--element-bg-base);

      .bitfun-git-panel__branch-actions {
        visibility: visible;
        opacity: 1;
        pointer-events: auto;
      }

      .bitfun-git-panel__list-item-text {
        padding-right: 90px;
        color: var(--color-text);
      }
    }

    &:active {
      background: var(--element-bg-active);
    }

    &--current {
      background: rgba(var(--color-success-rgb, 34, 197, 94), 0.08);
      
      .bitfun-git-panel__list-item-text {
        color: var(--color-success);
        font-weight: $font-weight-medium;
      }

      .bitfun-git-panel__icon--branch {
        color: var(--color-success);
      }
      
      &:hover {
        background: rgba(var(--color-success-rgb, 34, 197, 94), 0.12);
        
        .bitfun-git-panel__list-item-text {
          color: var(--color-success);
        }
        
        .bitfun-git-panel__icon--branch {
          color: var(--color-success);
        }
      }
    }
  }

  &__branch-info {
    display: flex;
    align-items: center;
    gap: $size-gap-2;
    flex: 1;
    min-width: 0;
  }

  &__branch-current-badge {
    margin-left: auto;
    padding: 2px 6px;
    font-size: $font-size-xs;
    font-weight: $font-weight-medium;
    color: $git-color-staged;
    background: $git-color-staged-bg-hover;
    border-radius: $size-radius-sm;
  }

  &__branch-actions {
    position: absolute;
    right: $size-gap-2;
    top: 50%;
    transform: translateY(-50%);
    display: flex;
    align-items: center;
    gap: 4px;
    visibility: hidden;
    opacity: 0;
    pointer-events: none;
    transition: opacity $motion-base $easing-standard, visibility $motion-base $easing-standard;
  }

  &__branch-action-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 24px;
    height: 24px;
    padding: 0;
    background: transparent;
    border: none;
    border-radius: $size-radius-sm;
    color: var(--color-text-tertiary);
    cursor: pointer;
    transition: all $motion-base $easing-standard;

    &:hover {
      background: var(--color-background-tertiary);
      color: var(--color-text);
    }

    &:disabled {
      opacity: $opacity-disabled;
      cursor: default;
    }

    &--danger {
      &:hover {
        background: $git-color-deleted-bg;
        color: $git-color-deleted;
      }
    }
  }


  &__empty-state {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 40px $size-gap-5;
    text-align: center;
    color: var(--color-text-secondary);

    svg {
      margin-bottom: $size-gap-4;
      opacity: $opacity-secondary;
    }

    h3 {
      font-size: $font-size-lg;
      font-weight: $font-weight-medium;
      margin-bottom: $size-gap-2;
      color: var(--color-text-primary);
    }

    p {
      font-size: $font-size-sm;
      opacity: $opacity-high;
      margin-bottom: $size-gap-4;
    }
  }

  &__init-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: $size-gap-4;
    height: 100%;
    gap: $size-gap-4;
  }

  &__init-decoration {
    display: flex;
    align-items: center;
    width: 100%;
    max-width: 200px;
    gap: $size-gap-2;
  }

  &__init-line {
    flex: 1;
    height: 1px;
    
    &--dashed {
      background: repeating-linear-gradient(
        90deg,
        var(--border-medium, #{$border-medium}) 0,
        var(--border-medium, #{$border-medium}) 4px,
        transparent 4px,
        transparent 8px
      );
    }
    
    &--solid {
      background: var(--border-medium, #{$border-medium});
    }
  }

  &__init-dot {
    width: 6px;
    height: 6px;
    border-radius: 50%;
    background: var(--color-text-secondary);
    flex-shrink: 0;
    
    &--muted {
      background: var(--border-medium, #{$border-medium});
    }
  }

  &__init-card {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: $size-gap-3;
    padding: $size-gap-5 $size-gap-4;
    border: 1px dashed var(--border-medium, #{$border-medium});
    border-radius: $size-radius-lg;
    background: transparent;
    transition: all $motion-base $easing-standard;
    width: 100%;
    max-width: 220px;
    
    &:hover {
      border-style: solid;
      background: var(--element-bg-subtle, #{$element-bg-subtle});
      
      .bitfun-git-panel__init-icon {
        color: var(--color-text-primary);
        transform: scale(1.05);
      }
      
      .bitfun-git-panel__init-button {
        border-style: solid;
        background: var(--element-bg-base);
      }
    }
  }

  &__init-icon {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 48px;
    height: 48px;
    border-radius: 50%;
    background: var(--element-bg-subtle, #{$element-bg-subtle});
    color: var(--color-text-secondary);
    transition: all $motion-base $easing-standard;
    
    svg {
      opacity: 0.8;
    }
  }

  &__init-text {
    text-align: center;
    
    h3 {
      font-size: $font-size-base;
      font-weight: $font-weight-medium;
      color: var(--color-text-primary);
      margin: 0 0 $size-gap-1 0;
    }
    
    p {
      font-size: $font-size-xs;
      color: var(--color-text-muted);
      margin: 0;
      line-height: 1.4;
    }
  }

  &__init-button {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: $size-gap-1;
    padding: $size-gap-2 $size-gap-4;
    border: 1px dashed var(--border-medium, #{$border-medium});
    border-radius: $size-radius-base;
    background: transparent;
    color: var(--color-text-secondary);
    font-size: $font-size-sm;
    font-weight: $font-weight-medium;
    font-family: $font-family-sans;
    cursor: pointer;
    transition: all $motion-base $easing-standard;
    width: 100%;
    
    &:hover {
      border-style: solid;
      border-color: var(--color-text-secondary);
      color: var(--color-text-primary);
      background: var(--element-bg-base);
      
      svg {
        transform: rotate(90deg);
      }
    }
    
    &:active {
      transform: scale(0.98);
    }
    
    svg {
      transition: transform $motion-base $easing-standard;
    }
  }

  &__init-hint {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: $size-gap-2 $size-gap-3;
    font-size: $font-size-xs;
    color: var(--color-text-muted);
    background: transparent;
    border-radius: $size-radius-base;
    max-width: 220px;
    text-align: center;
    line-height: 1.4;
  }

  &__loading-state {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    height: 100%;
    padding: 40px $size-gap-5;
    text-align: center;
    color: var(--color-text-secondary);

    p {
      font-size: $font-size-sm;
      margin-top: $size-gap-2;
    }
  }

  &__loading-spinner {
    width: 32px;
    height: 32px;
    border: 3px solid $border-base;
    border-top-color: var(--color-accent-500);
    border-radius: $size-radius-full;
    animation: bitfun-git-panel-spin 1s linear infinite;

    &--small {
      width: 16px;
      height: 16px;
      border-width: 2px;
    }
  }

}

@keyframes bitfun-git-panel-spin {
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
}


@keyframes bitfun-git-panel-shake {
  0%, 100% {
    transform: translateX(0);
  }
  25% {
    transform: translateX(-5px);
  }
  75% {
    transform: translateX(5px);
  }
}

@media (max-width: 768px) {
  .bitfun-git-panel {
    &__content {
      padding: $size-gap-1 0;
    }

    &__quick-actions {
      grid-template-columns: 1fr;
    }

    &__status-grid {
      grid-template-columns: 1fr 1fr;
    }
  }
}


@container git-panel (max-width: 140px) {
  .bitfun-git-panel {

    &__commit-section {
      padding: 0 10px 10px;
      gap: 8px;
    }

    &__status-row {
      gap: 6px;
      padding: 6px 0 0 0;
    }

    &__status-branch {
      max-width: 60px;
      font-size: 12px;
    }

    &__status-badges {
      margin-left: 4px;
      gap: 2px;
    }

    &__status-badge {
      padding: 2px 4px;
      font-size: 10px;
    }

    &__status-actions {
      gap: 2px;
      
      button {
        width: 24px;
        height: 24px;
        
        svg {
          width: 12px;
          height: 12px;
        }
      }
    }

    &__commit-input .bitfun-textarea__field {
      min-height: 50px;
      font-size: 12px;
    }

    &__ai-btn {
      width: 24px;
      height: 24px;
      right: 6px;
      top: 6px;
      
      svg {
        width: 14px;
        height: 14px;
      }
    }

    &__tabs {
      padding: 6px 8px;
      gap: 2px;

      &::after {
        left: 8px;
        right: 8px;
      }
    }

    &__tab {
      padding: 6px;
      font-size: 12px;
      border-radius: 4px;

      &--active::after {
        bottom: -6px;
        left: 30%;
        right: 30%;
      }
    }

    &__tab-text {
      display: none;
    }

    &__tab-icon {
      width: 16px;
      height: 16px;
    }

    &__search-area {
      padding: 8px 10px;
    }

    &__search-row {
      gap: 6px;
    }

    &__icon-button {
      width: 28px;
      height: 28px;
    }

    &__search-box {
      padding: 6px 8px;
    }

    &__list-header {
      padding: 6px 10px;
      font-size: 11px;
    }

    &__list-item {
      padding: 4px 10px;
      gap: 4px;
    }

    &__checkbox-btn {
      width: 18px;
      height: 18px;
      
      svg {
        width: 14px;
        height: 14px;
      }
    }

    &__list-item-text {
      font-size: 12px;
    }

    &__file-status-badge {
      min-width: 12px;
      font-size: 10px;
    }

    &__file-action-btn {
      width: 20px;
      height: 20px;
      
      svg {
        width: 12px;
        height: 12px;
      }
    }

    &__folder-item {
      padding: 4px 10px;
      gap: 4px;
    }

    &__folder-toggle {
      width: 18px;
      height: 18px;
    }

    &__folder-name {
      font-size: 12px;
    }

    &__file-item--nested {
      padding-left: calc(10px + 20px);
    }

    &__commit-item {
      padding: 4px 10px 4px calc(10px + 22px);
      min-height: 36px;
    }

    &__timeline-node {
      left: 10px;
      width: 16px;

      &::before,
      &::after {
        width: 1.5px;
      }
    }

    &__timeline-dot {
      width: 8px;
      height: 8px;
      border-width: 1.5px;
    }

    &__commit-message {
      font-size: 12px;
    }

    &__commit-meta {
      font-size: 11px;
      gap: 4px;
    }

    &__commit-author {
      max-width: 60px;
    }

    &__commit-actions {
      gap: 2px;
    }

    &__commit-action-btn {
      width: 20px;
      height: 20px;
      
      svg {
        width: 12px;
        height: 12px;
      }
    }

    &__branch-current-badge {
      padding: 2px 6px;
      font-size: 10px;
    }

    &__branch-action-btn {
      width: 20px;
      height: 20px;
      
      svg {
        width: 12px;
        height: 12px;
      }
    }

    &__empty-state {
      padding: 24px $size-gap-4;
      
      svg {
        width: 36px;
        height: 36px;
      }
      
      h3 {
        font-size: 14px;
      }
      
      p {
        font-size: 12px;
      }
    }

    &__list-empty {
      padding: $size-gap-4;
      font-size: 12px;
    }

    &__init-container {
      padding: $size-gap-3;
      gap: $size-gap-3;
    }

    &__init-decoration {
      max-width: 160px;
    }

    &__init-card {
      padding: $size-gap-4 $size-gap-3;
      max-width: 180px;
      gap: $size-gap-2;
    }

    &__init-icon {
      width: 40px;
      height: 40px;
      
      svg {
        width: 20px;
        height: 20px;
      }
    }

    &__init-text {
      h3 {
        font-size: 13px;
      }
      
      p {
        font-size: 11px;
      }
    }

    &__init-button {
      padding: 6px $size-gap-3;
      font-size: 12px;
    }

    &__init-hint {
      padding: $size-gap-1 $size-gap-2;
      font-size: 10px;
      max-width: 180px;
    }
  }
}


@container git-panel (max-width: 320px) {
  .bitfun-git-panel {
    &__tabs {
      padding: $size-gap-2;
      gap: 4px;

      &::after {
        left: $size-gap-2;
        right: $size-gap-2;
      }
    }

    &__tab {
      padding: 7px;
      min-width: 32px;
      border-radius: 5px;

      &--active::after {
        bottom: -$size-gap-2;
        left: 28%;
        right: 28%;
      }
    }

    &__tab-text {
      display: none;
    }

    &__tab-icon {
      width: 16px;
      height: 16px;
    }
  }
}

