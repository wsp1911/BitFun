@use 'sass:color';
@use '../../../../component-library/styles/tokens' as *;

$_diff-spinner-size: 40px;
$_diff-spinner-border: 4px;
$_diff-icon-size: 96px;
$_diff-padding-mobile: 20px;
$_diff-padding-desktop: 32px;

.git-diff-editor {
  display: flex;
  flex-direction: column;
  height: 100%;
  width: 100%;
  background: var(--color-bg-primary);
  overflow: hidden;
  position: relative;

  &__error {
    display: flex;
    align-items: center;
    gap: $size-gap-2;
    padding: $size-gap-3 $size-gap-4;
    background: var(--color-bg-primary);
    border: 1px solid rgba(239, 68, 68, 0.3);
    border-radius: 0;
    border-bottom: 1px solid rgba(239, 68, 68, 0.5);
    color: var(--color-error);
    font-size: $font-size-sm;
    font-weight: $font-weight-medium;
    font-family: $font-family-mono;
    animation: git-diff-editor-error-slide-in 0.3s ease-out;

    svg {
      flex-shrink: 0;
      filter: drop-shadow(0 0 8px rgba(239, 68, 68, 0.4));
    }
  }

  &__content {
    flex: 1;
    min-height: 0;
    overflow: hidden;
    position: relative;
    display: flex;
    flex-direction: column;
    margin: 0 8px 8px;
    border-radius: 6px;
    
    box-shadow: 
      inset 0 1px 3px rgba(0, 0, 0, 0.2),
      0 0 0 1px rgba(255, 255, 255, 0.03);
    
    background: linear-gradient(
      180deg,
      rgba(255, 255, 255, 0.01) 0%,
      transparent 100%
    );
    
    > .diff-editor-container {
      flex: 1;
      height: 100%;
      width: 100%;
      border-radius: 6px;
      overflow: hidden;
    }
    
    :global {
      .monaco-diff-editor .gutter {
        background: transparent !important;
        outline: none !important;
        box-shadow: none !important;
        border: none !important;
      }
      
      .monaco-diff-editor .codicon,
      .monaco-diff-editor .codicon-arrow-small-left,
      .monaco-diff-editor .codicon-discard,
      .monaco-diff-editor .revert-button,
      .monaco-diff-editor .dirty-diff-modified-glyph,
      .monaco-diff-editor .dirty-diff-added-glyph,
      .monaco-diff-editor .dirty-diff-deleted-glyph,
      .monaco-diff-editor .margin-view-overlays .codicon {
        outline: none !important;
        border: none !important;
        box-shadow: none !important;
        color: var(--color-text-muted, rgba(255, 255, 255, 0.35)) !important;
        
        &:hover {
          color: var(--color-text-secondary, rgba(255, 255, 255, 0.5)) !important;
          background: transparent !important;
        }
        
        &:focus {
          outline: none !important;
          border: none !important;
          box-shadow: none !important;
        }
      }
      
      .monaco-diff-editor .view-zones,
      .monaco-diff-editor .view-overlays,
      .monaco-diff-editor .view-overlays > div,
      .monaco-diff-editor .current-line,
      .monaco-diff-editor .selected-text {
        outline: none !important;
        border: none !important;
      }
      
      .monaco-diff-editor .line-insert,
      .monaco-diff-editor .line-delete,
      .monaco-diff-editor .char-insert,
      .monaco-diff-editor .char-delete {
        border: none !important;
        outline: none !important;
      }
      
      .monaco-diff-editor .insert-sign,
      .monaco-diff-editor .delete-sign {
        border: none !important;
        background: transparent !important;
      }
      
      .monaco-diff-editor .gutterItem,
      .monaco-diff-editor .gutter-item {
        background: transparent !important;
        outline: none !important;
        border: none !important;
        box-shadow: none !important;
        
        .background,
        > div {
          border: none !important;
          background: transparent !important;
          outline: none !important;
        }
      }
      
      .monaco-editor .inputarea,
      .monaco-editor .inputarea:focus {
        outline: none !important;
        border: none !important;
        box-shadow: none !important;
      }
      
      .monaco-diff-editor,
      .monaco-diff-editor .diff-editor-border,
      .monaco-diff-editor .diff-view-overview {
        border: none !important;
        outline: none !important;
      }
      
      .monaco-diff-editor .line-decoration,
      .monaco-diff-editor .decorationsOverviewRuler {
        border: none !important;
        background: transparent !important;
      }
      
      .monaco-diff-editor .monaco-sash,
      .monaco-diff-editor .sash {
        background: transparent !important;
        
        &::before {
          content: '';
          position: absolute;
          top: 0;
          bottom: 0;
          left: 50%;
          width: 1px;
          background: var(--border-medium, rgba(255, 255, 255, 0.08));
          border-left: 1px dashed var(--border-medium, rgba(255, 255, 255, 0.08));
          transition: all 0.2s ease;
        }
        
        &:hover::before {
          border-left-style: solid;
          border-left-color: var(--border-light, rgba(255, 255, 255, 0.2));
        }
      }
      
      .monaco-diff-editor.side-by-side .editor.original {
        border-right: 1px dashed var(--border-medium, rgba(255, 255, 255, 0.08)) !important;
        
        &:hover {
          border-right-style: solid !important;
        }
      }
      
      .monaco-diff-editor.side-by-side .editor.modified {
        border-left: 1px dashed var(--border-medium, rgba(255, 255, 255, 0.08)) !important;
        
        &:hover {
          border-left-style: solid !important;
        }
      }
      
      .monaco-diff-editor .diffViewport {
        background: rgba(255, 255, 255, 0.02) !important;
      }
      
      .monaco-diff-editor .diagonal-fill {
        background-color: var(--color-bg-secondary, #0d0d0f) !important;
        background-image: repeating-linear-gradient(
          45deg,
          transparent,
          transparent 3px,
          rgba(255, 255, 255, 0.015) 3px,
          rgba(255, 255, 255, 0.015) 6px
        ) !important;
      }
    }
  }

  &__saving-indicator {
    position: absolute;
    top: $size-gap-3;
    right: $size-gap-3;
    padding: $size-gap-2 $size-gap-4;
    background: rgba(0, 0, 0, 0.8);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: $size-radius-base;
    color: var(--color-text-secondary);
    font-size: $font-size-sm;
    font-family: $font-family-mono;
    z-index: $z-overlay;
    animation: git-diff-editor-fade-in 0.2s ease-out;
    backdrop-filter: blur(4px);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
  }

  &__processing-overlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.85);
    backdrop-filter: blur(8px);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: $size-gap-4;
    z-index: $z-overlay;
    animation: git-diff-editor-fade-in 0.2s ease-out;

    p {
      font-size: $font-size-base;
      font-weight: $font-weight-medium;
      font-family: $font-family-mono;
      color: var(--color-text-primary);
      animation: git-diff-editor-pulse $motion-slow ease-in-out infinite;
    }
  }

  &__spinner {
    width: $_diff-spinner-size;
    height: $_diff-spinner-size;
    border: $_diff-spinner-border solid $color-accent-200;
    border-top-color: var(--color-accent-500);
    border-radius: $size-radius-full;
    animation: git-diff-editor-spin $motion-lazy $easing-standard infinite;
    box-shadow: 
      0 0 20px rgba(96, 165, 250, 0.3),
      0 0 40px rgba(96, 165, 250, 0.15);
  }

  &__completed-message {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: $_diff-padding-desktop;
    text-align: center;
    flex: 1;
    animation: git-diff-editor-fade-in 0.3s ease-out;
  }

  &__completed-icon {
    display: flex;
    align-items: center;
    justify-content: center;
    width: $_diff-icon-size;
    height: $_diff-icon-size;
    border-radius: $size-radius-full;
    margin-bottom: $size-gap-6;
    animation: git-diff-editor-scale-bounce 0.5s $easing-standard;
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);

    &--accepted {
      background: linear-gradient(135deg, 
        color.adjust($color-success, $lightness: 10%) 0%, 
        $color-success 100%
      );
      color: #ffffff;
      box-shadow: 
        0 8px 24px rgba(34, 197, 94, 0.4),
        0 0 40px rgba(34, 197, 94, 0.2);
    }

    &--rejected {
      background: linear-gradient(135deg, 
        color.adjust($color-error, $lightness: 10%) 0%, 
        $color-error 100%
      );
      color: #ffffff;
      box-shadow: 
        0 8px 24px rgba(239, 68, 68, 0.4),
        0 0 40px rgba(239, 68, 68, 0.2);
    }

    svg {
      filter: drop-shadow(0 2px 8px rgba(0, 0, 0, 0.3));
    }
  }

  &__completed-title {
    font-size: $font-size-2xl;
    font-weight: $font-weight-semibold;
    font-family: $font-family-mono;
    color: var(--color-text-primary);
    margin-bottom: $size-gap-4;
    animation: git-diff-editor-slide-up 0.4s ease-out 0.1s both;
  }

  &__completed-details {
    display: flex;
    flex-direction: column;
    gap: $size-gap-2;
    animation: git-diff-editor-slide-up 0.4s ease-out 0.2s both;

    .git-diff-editor__file-path {
      font-size: $font-size-base;
      font-family: $font-family-mono;
      color: var(--color-text-muted);
    }
  }

  &__result-text {
    font-size: $font-size-base;
    font-weight: $font-weight-medium;
    font-family: $font-family-mono;
    margin-top: $size-gap-3;

    &--success {
      color: var(--color-success);
    }

    &--warning {
      color: var(--color-warning);
    }
  }
}

@keyframes git-diff-editor-spin {
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
}

@keyframes git-diff-editor-pulse {
  0%, 100% {
    opacity: 1;
  }
  50% {
    opacity: 0.6;
  }
}

@keyframes git-diff-editor-fade-in {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

@keyframes git-diff-editor-scale-bounce {
  0% {
    transform: scale(0);
    opacity: 0;
  }
  50% {
    transform: scale(1.1);
  }
  100% {
    transform: scale(1);
    opacity: 1;
  }
}

@keyframes git-diff-editor-slide-up {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes git-diff-editor-error-slide-in {
  from {
    opacity: 0;
    transform: translateY(-10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@media (max-width: 768px) {
  .git-diff-editor {
    &__content {
      margin: 0 6px 6px;
      border-radius: 4px;
    }

    &__completed-message {
      padding: $_diff-padding-mobile;
    }

    &__completed-icon {
      width: $_diff-icon-size * 0.75;
      height: $_diff-icon-size * 0.75;
      margin-bottom: $size-gap-4;

      svg {
        width: 36px;
        height: 36px;
      }
    }

    &__completed-title {
      font-size: $font-size-xl;
    }

    &__spinner {
      width: $_diff-spinner-size * 0.75;
      height: $_diff-spinner-size * 0.75;
      border-width: $_diff-spinner-border - 1px;
    }
  }
}

@media (prefers-contrast: high) {
  .git-diff-editor {
    &__spinner {
      border-color: var(--color-text-muted);
      border-top-color: var(--color-text-primary);
    }

    &__completed-icon {
      filter: none;

      svg {
        filter: none;
      }
    }

    &__error {
      border-width: 2px;

      svg {
        filter: none;
      }
    }
  }
}
